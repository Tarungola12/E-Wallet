<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>E-Wallet Frontend</title>

<style>
:root {
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#000000;
  --btn:#0d6efd;
}

body.dark {
  --bg:#121212;
  --card:#1e1e1e;
  --text:#ffffff;
  --btn:#198754;
}

body {
  background:var(--bg);
  color:var(--text);
  font-family:Arial, sans-serif;
  padding:20px;
  transition:0.3s;
}

.container {
  max-width:700px;
  margin:auto;
}

.card {
  background:var(--card);
  padding:20px;
  border-radius:8px;
  margin-bottom:20px;
}

h2 {
  margin-bottom:10px;
}

input, select, button {
  width:100%;
  padding:10px;
  margin-top:10px;
}

button {
  background:var(--btn);
  color:white;
  border:none;
  cursor:pointer;
}

button:hover {
  opacity:0.9;
}

.result {
  margin-top:10px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<button onclick="toggleMode()">üåô / ‚òÄÔ∏è Toggle Mode</button>

<!-- ================= USER ONBOARD ================= -->
<div class="card">
<h2>User Onboarding</h2>

<input id="name" placeholder="Name">
<input id="email" placeholder="Email">
<input id="mobileNo" placeholder="Mobile Number">
<input id="password" type="password" placeholder="Password">
<input id="dob" placeholder="DOB (YYYY-MM-DD)">

<select id="identifier">
  <option value="AADHAAR_CARD">AADHAAR CARD</option>
  <option value="PAN_CARD">PAN CARD</option>
  <option value="DRIVING_LICENSE">DRIVING LICENSE</option>
  <option value="PASSPORT">PASSPORT</option>
</select>

<input id="identifierValue" placeholder="Identifier Value">

<button onclick="createUser()">Create User</button>
<div id="userResult" class="result"></div>
</div>

<!-- ================= OTP VERIFY ================= -->
<div class="card">
<h2>OTP Verification</h2>

<input id="otpMobile" placeholder="Mobile">
<input id="otpEmail" placeholder="Email">
<input id="otp" placeholder="OTP">

<button onclick="verifyOtp()">Verify OTP</button>
<div id="otpResult" class="result"></div>
</div>

<!-- ================= TRANSACTION ================= -->
<div class="card">
<h2>Create Transaction</h2>

<input id="authEmail" placeholder="Sender Email (Basic Auth)">
<input id="authPassword" type="password" placeholder="Password">

<input id="receiver" placeholder="Receiver Mobile">
<input id="purpose" placeholder="Purpose">
<input id="amount" type="number" placeholder="Amount">

<button onclick="createTxn()">Send Money</button>
<div id="txnResult" class="result"></div>
</div>

</div>

<script>
/* ================= COMMON ================= */
function toggleMode() {
  document.body.classList.toggle("dark");
}

/* ================= USER CREATE ================= */
function createUser() {
  const payload = {
    name: document.getElementById("name").value.trim(),
    email: document.getElementById("email").value.trim(),
    mobileNo: document.getElementById("mobileNo").value.trim(),
    password: document.getElementById("password").value.trim(),
    dob: document.getElementById("dob").value.trim(),
    userIdentifier: document.getElementById("identifier").value,
    userIdentifierValue: document.getElementById("identifierValue").value.trim()
  };

  fetch("http://localhost:8081/user-service/onboard/user", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    userResult.innerText =
      `${data.status} | ${data.message} | Mobile: ${data.mobileNo}`;
  })
  .catch(() => {
    userResult.innerText = "User creation failed";
  });
}

/* ================= OTP VERIFY ================= */
function verifyOtp() {
  const payload = {
    mobile: document.getElementById("otpMobile").value.trim(),
    email: document.getElementById("otpEmail").value.trim(),
    otp: document.getElementById("otp").value.trim()
  };

  fetch("http://localhost:8081/user-service/validate/otp", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    otpResult.innerText = "OTP Status: " + data.status;
  })
  .catch(() => {
    otpResult.innerText = "OTP verification failed";
  });
}

/* ================= TRANSACTION ================= */
function createTxn() {

  const username = document.getElementById("authEmail").value.trim();
  const password = document.getElementById("authPassword").value.trim();

  const payload = {
    receiver: document.getElementById("receiver").value.trim(),
    purpose: document.getElementById("purpose").value.trim(),
    transferAmount: Number(document.getElementById("amount").value)
  };

  const authHeader =
    "Basic " + window.btoa(
      unescape(encodeURIComponent(username + ":" + password))
    );

  fetch("http://localhost:8084/transaction-service/create/txn", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": authHeader
    },
    body: JSON.stringify(payload)
  })
  .then(async res => {
    const text = await res.text();
    if (!res.ok) throw new Error(text || res.status);
    return text;
  })
  .then(txnId => {
    txnResult.innerText = "Transaction Successful ‚úÖ TxnId: " + txnId;
  })
  .catch(err => {
    txnResult.innerText = "Transaction Failed ‚ùå " + err.message;
  });
}
</script>

</body>
</html>
